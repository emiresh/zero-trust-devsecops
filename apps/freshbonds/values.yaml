app:
  name: freshbonds

namespace: dev

# Secrets are now managed via Sealed Secrets
# See templates/sealed-secret.yaml
# To update secrets:
# 1. Create a plain secret file (don't commit!)
# 2. Seal it: kubeseal --controller-namespace sealed-secrets --format yaml < plain-secret.yaml > templates/sealed-secret.yaml
# 3. Commit the sealed-secret.yaml file

deployments:
  - name: apigateway
    replicaCount: 2
    image:
      repository: emiresh/freshbonds-api-gateway
      tag: latest
      pullPolicy: IfNotPresent
    service:
      name: apigateway-service
      port: 8080
      targetPort: 8080
    ingress:
      enabled: false
    envFrom:
      - secretRef:
          name: freshbonds-secrets
    env:
      - name: USER_SERVICE_URL
        value: "http://user-service:8082"
      - name: PRODUCT_SERVICE_URL
        value: "http://product-service:8081"
      - name: PORT
        value: "8080"

  - name: frontend
    replicaCount: 2
    image:
      repository: emiresh/freshbonds-frontend
      tag: v1.2.0
      pullPolicy: IfNotPresent
    service:
      name: frontend-service
      port: 80
      targetPort: 3000
    ingress:
      enabled: true
      path: /
      pathType: Prefix
    env:
      - name: API_GATEWAY_HOST
        value: "apigateway-service"
      - name: API_GATEWAY_PORT
        value: "8080"
      - name: REACT_APP_API_URL
        value: "http://apigateway-service:8080"
      - name: NODE_ENV
        value: "production"

  - name: product-service
    replicaCount: 2
    image:
      repository: emiresh/freshbonds-product-service
      tag: latest
      pullPolicy: IfNotPresent
    service:
      name: product-service
      port: 8081
      targetPort: 3002
    ingress:
      enabled: false
    envFrom:
      - secretRef:
          name: freshbonds-secrets
    env:
      - name: SERVICE_PORT
        value: "3002"

  - name: user-service
    replicaCount: 2
    image:
      repository: emiresh/freshbonds-user-service
      tag: latest
      pullPolicy: IfNotPresent
    service:
      name: user-service
      port: 8082
      targetPort: 3001
    ingress:
      enabled: false
    envFrom:
      - secretRef:
          name: freshbonds-secrets
    env:
      - name: SERVICE_PORT
        value: "3001"

ingress:
  className: nginx
  host: freshbonds.com
  sslRedirect: false
  forceSslRedirect: true
  rewriteTarget: /
  tls:
    enabled: true
    clusterIssuer: letsencrypt
    secretName: freshbonds-tls
