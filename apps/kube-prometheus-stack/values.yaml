# Custom values for kube-prometheus-stack
# You can modify these values according to your needs

# Global configuration
global:
  scrapeInterval: 30s
  scrapeTimeout: 10s
  evaluationInterval: 30s

# Prometheus configuration
prometheus:
  enabled: true
  prometheusSpec:
    replicas: 1
    retention: 7d
    retentionSize: 10GiB
    
    # Storage configuration
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: default  # Change to your preferred storage class
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi

    # Minimal resource limits and requests
    resources:
      requests:
        memory: 512Mi
        cpu: 200m
      limits:
        memory: 1Gi
        cpu: 500m

    # Service Monitor configuration
    serviceMonitorSelectorNilUsesHelmValues: false
    ruleSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    probeSelectorNilUsesHelmValues: false

    # External URL for your domain (change to https when ready)
    externalUrl: http://prometheus.k8.publicvm.com

    # Additional scrape configs (optional)
    additionalScrapeConfigs: []

  # Ingress configuration for Prometheus
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /
      # Uncomment for HTTPS:
      # cert-manager.io/cluster-issuer: letsencrypt-prod
      # nginx.ingress.kubernetes.io/ssl-redirect: "true"
      # nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    hosts:
      - host: prometheus.k8.publicvm.com
        paths:
          - path: /
            pathType: Prefix
    # Uncomment for HTTPS:
    # tls:
    #   - secretName: prometheus-tls
    #     hosts:
    #       - prometheus.k8.publicvm.com

# Grafana configuration
grafana:
  enabled: true
  
  # Admin credentials (CHANGE THESE IN PRODUCTION!)
  adminUser: admin
  adminPassword: admin123
  
  # Persistence
  persistence:
    enabled: true
    storageClassName: default  # Change to your preferred storage class
    size: 5Gi
    
  # Minimal resource limits and requests
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 100m

  # Service configuration
  service:
    type: ClusterIP
    
  # Ingress configuration
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /
      # Uncomment for HTTPS:
      # cert-manager.io/cluster-issuer: letsencrypt-prod
      # nginx.ingress.kubernetes.io/ssl-redirect: "true"
      # nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    hosts:
      - host: grafana.k8.publicvm.com
        paths:
          - path: /
            pathType: Prefix
    # Uncomment for HTTPS:
    # tls:
    #   - secretName: grafana-tls
    #     hosts:
    #       - grafana.k8.publicvm.com

  # Grafana configuration
  grafana.ini:
    server:
      root_url: http://grafana.k8.publicvm.com  # Change to https when ready
      serve_from_sub_path: false
    security:
      allow_embedding: true
      cookie_secure: false  # Change to true for HTTPS
    auth.anonymous:
      enabled: true
      org_role: Viewer
    users:
      allow_sign_up: false
      allow_org_create: false
      auto_assign_org: true
      auto_assign_org_role: Viewer

  # Dashboard providers
  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
      - name: 'default'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/default

  # Pre-configured dashboards
  dashboards:
    default:
      # Kubernetes cluster monitoring
      kubernetes-cluster:
        gnetId: 7249
        revision: 1
        datasource: Prometheus
      
      # Kubernetes pod monitoring
      kubernetes-pods:
        gnetId: 6417
        revision: 1
        datasource: Prometheus
        
      # Node Exporter dashboard
      node-exporter:
        gnetId: 1860
        revision: 31
        datasource: Prometheus
        
      # Kubernetes deployment dashboard
      kubernetes-deployment:
        gnetId: 8588
        revision: 1
        datasource: Prometheus

  # Data sources (Prometheus will be auto-configured)
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
      - name: Prometheus
        type: prometheus
        url: http://kube-prometheus-stack-prometheus:9090
        access: proxy
        isDefault: true

# AlertManager configuration
alertmanager:
  enabled: true
  alertmanagerSpec:
    replicas: 1
    
    # Storage configuration
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: default  # Change to your preferred storage class
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 2Gi

    # Minimal resource limits and requests
    resources:
      requests:
        memory: 64Mi
        cpu: 50m
      limits:
        memory: 128Mi
        cpu: 100m

    # External URL for your domain (change to https when ready)
    externalUrl: http://alertmanager.k8.publicvm.com

  # Service configuration
  service:
    type: ClusterIP

  # Ingress configuration for AlertManager
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /
      # Uncomment for HTTPS:
      # cert-manager.io/cluster-issuer: letsencrypt-prod
      # nginx.ingress.kubernetes.io/ssl-redirect: "true"
      # nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    hosts:
      - host: alertmanager.k8.publicvm.com
        paths:
          - path: /
            pathType: Prefix
    # Uncomment for HTTPS:
    # tls:
    #   - secretName: alertmanager-tls
    #     hosts:
    #       - alertmanager.k8.publicvm.com

  # AlertManager configuration
  config:
    global:
      smtp_smarthost: 'localhost:587'
      smtp_from: 'alertmanager@yourdomain.com'
    route:
      group_by: ['alertname']
      group_wait: 10s
      group_interval: 10s
      repeat_interval: 1h
      receiver: 'web.hook'
    receivers:
    - name: 'web.hook'
      webhook_configs:
      - url: 'http://127.0.0.1:5001/'

# Node Exporter configuration
nodeExporter:
  enabled: true
  serviceMonitor:
    enabled: true

# Kube State Metrics configuration
kubeStateMetrics:
  enabled: true

# Component monitoring settings
coreDns:
  enabled: true

kubelet:
  enabled: true
  serviceMonitor:
    https: true

kubeControllerManager:
  enabled: true

kubeScheduler:
  enabled: true

kubeProxy:
  enabled: true

kubeEtcd:
  enabled: true

# Default alerting rules
defaultRules:
  create: true
  rules:
    alertmanager: true
    etcd: true
    configReloaders: true
    general: true
    k8s: true
    kubeApiserverAvailability: true
    kubeApiserverBurnrate: true
    kubeApiserverHistogram: true
    kubeApiserverSlos: true
    kubelet: true
    kubeProxy: true
    kubePrometheusGeneral: true
    kubePrometheusNodeRecording: true
    kubernetesApps: true
    kubernetesResources: true
    kubernetesStorage: true
    kubernetesSystem: true
    kubeScheduler: true
    kubeStateMetrics: true
    network: true
    node: true
    nodeExporterAlerting: true
    nodeExporterRecording: true
    prometheus: true
    prometheusOperator: true

# Prometheus Operator configuration
prometheusOperator:
  enabled: true
  resources:
    requests:
      memory: 64Mi
      cpu: 50m
    limits:
      memory: 128Mi
      cpu: 100m